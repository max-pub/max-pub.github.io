<html>

<head>
	<meta name="mobile-web-app-capable" content="yes">
	<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="white">
	<meta name="apple-mobile-web-app-title" content="Immo PWA">

	<link href="https://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet">
	<link href="style.css" rel="stylesheet">
</head>

<body>


	<!-- <script type='module' src='nav.js'></script> -->

	<style>

	</style>

	<h1>Immobilien Rechner</h1>
	<i>123&#8239;456</i>
	<table>
		<tr>
			<td>Kaufpreis</td>
			<td> <input nav-key='kaufpreis' type='number' step='5000' /> </td>
			<td>&euro;</td>
		</tr>
		<tr>
			<td colspan='3'><br /></td>
		</tr>

		<tr>
			<td>Maklerprovision</td>
			<td> <input type='number' nav-key='makler' step="0.01" /> </td>
			<td>%</td>
		</tr>
		<tr class='small'>
			<td></td>
			<td> = <output id='makler_abs'></output> </td>
			<td>&euro;</td>
		</tr>
		<tr>
			<td>Notarkosten</td>
			<td> <input nav-key='notar' type='number' step="0.01" /> </td>
			<td>%</td>
		</tr>
		<tr class='small'>
			<td></td>
			<td> = <output id='notar_abs'></output> </td>
			<td>&euro;</td>
		</tr>
		<tr>
			<td>Grunderwerbsteuer</td>
			<td> <input nav-key='steuer' type='number' value='12.00' step="0.1" /> </td>
			<td>%</td>
		</tr>
		<tr class='small'>
			<td></td>
			<td> = <output id='steuer_abs'></output> </td>
			<td>&euro;</td>
		</tr>
		<tr>
			<td>Grundbucheintrag</td>
			<td> <input nav-key='grundbuch' type='number' value='12.00' step="0.1" /> </td>
			<td>%</td>
		</tr>
		<tr class='small'>
			<td></td>
			<td> = <output id='grundbuch_abs'></output> </td>
			<td>&euro;</td>
		</tr>
		<tr>
			<td colspan='3'><br /></td>
		</tr>
		<tr class='small'>
			<td>Transaktionskosten</td>
			<td> = <output id='kosten_trans'></output> </td>
			<td>&euro;</td>
		</tr>
		<tr>
			<td>Gesamtkosten</td>
			<td> = <output id='kosten_gesamt'></output> </td>
			<td>&euro;</td>
		</tr>
		<tr>
			<td colspan='5'>
				<hr />
			</td>
		</tr>
		<tr>
			<td>Fl&auml;che</td>
			<td> <input nav-key='flaeche' type='number' step="1" /> </td>
			<td>m<sup>2</sup></td>
		</tr>
		<tr class='small'>
			<td></td>
			<td> = <output id='preis_qm'></output> </td>
			<td>&euro; <u>/m<sup>2</sup></u></td>
		</tr>
		<tr>
			<td colspan='5'>
				<hr />
			</td>
		</tr>
		<tr>
			<td>Miete</td>
			<td> <input nav-key='miete_monat' type='number' step="5" /> </td>
			<td>&euro; <u>/Monat</u></td>
		</tr>
		<tr>
			<td>Miete</td>
			<td> <input nav-key='miete_monat_qm' type='number' step="0.5" /> </td>
			<td>&euro; <u>/Monat /m<sup>2</sup></u></td>
		</tr>
		<tr>
			<td>Miete</td>
			<td> <input nav-key='miete_jahr' type='number' step="10" /> </td>
			<td>&euro; <u>/Jahr</u></td>
		</tr>
		<tr>
			<td>Rendite</td>
			<td> <input nav-key='rendite' type='number' step="0.1" /> </td>
			<td>%</td>
		</tr>
		<tr>
			<td>Amortisation</td>
			<td> <input nav-key='amortisation' type='number' step="0.1" /> </td>
			<td>Jahre</td>
		</tr>


	</table>
	<br />
	<br />
	<br />
	<a id='mail' href=''>send mail</a>

	<script type='module'>
		let $ = x => document.querySelector(x)
		import * as nav from './nav.js'
		nav.init({ kaufpreis: 125_000, makler: 3.57, notar: 1.5, steuer: 6.5, grundbuch: 0.5, flaeche: 50, miete_monat: 500 })

		function update() {
			console.log("NAV", nav.state)
			console.log("OLD", nav.oldState)
			console.log("DIFF", nav.diffState)
			let s = nav.state
			// var price = document.getElementById('price');
			// var mak_rel = document.getElementById('mak_rel');
			// var mak_abs = document.getElementById('mak_abs');
			// var tax_rel = document.getElementById('tax_rel');
			// var tax_abs = document.getElementById('tax_abs');
			// var total = document.getElementById('total');
			$('#makler_abs').value = (s.kaufpreis * s.makler / 100).toFixed(2)
			$('#notar_abs').value = (s.kaufpreis * s.notar / 100).toFixed(2)
			$('#steuer_abs').value = (s.kaufpreis * s.steuer / 100).toFixed(2)
			$('#grundbuch_abs').value = (s.kaufpreis * s.grundbuch / 100).toFixed(2)
			let trans = (s.makler * 1 + s.notar * 1 + s.steuer * 1 + s.grundbuch * 1) / 100
			$('#kosten_trans').value = (s.kaufpreis * trans).toFixed(2)
			let gesamtkosten = s.kaufpreis * (1 + trans)
			$('#kosten_gesamt').value = gesamtkosten.toFixed(2)

			$('#preis_qm').value = (gesamtkosten / s.flaeche).toFixed(2)

			let diff = nav.diffState
			if (diff.rendite) s.miete_jahr = (s.rendite * gesamtkosten / 100).toFixed(2)
			if (diff.amortisation) s.miete_jahr = (gesamtkosten / s.amortisation).toFixed(2)
			if (diff.miete_monat) s.miete_jahr = (s.miete_monat * 12).toFixed(2)
			if (diff.miete_monat_qm) s.miete_jahr = (s.miete_monat_qm * s.flaeche * 12).toFixed(2)

			s.miete_monat = (s.miete_jahr / 12).toFixed(2)
			s.miete_monat_qm = (s.miete_jahr / 12 / s.flaeche).toFixed(2)
			s.rendite = (s.miete_jahr / gesamtkosten * 100).toFixed(2)
			s.amortisation = (gesamtkosten / s.miete_jahr).toFixed(1)
			nav.setURL(s)

			// mak_abs.innerHTML = Math.round(price.value * mak_rel.value / 100);
			// tax_abs.innerHTML = Math.round(price.value * tax_rel.value / 100);
			// total.innerHTML = Math.round(price.value * 1 + mak_abs.innerHTML * 1 + tax_abs.innerHTML * 1);

			// var size = document.getElementById('size');
			// var sizeprice = document.getElementById('sizeprice');
			// sizeprice.innerHTML = Math.round(total.innerHTML * 1 / size.value);

			// var rent_mon = document.getElementById('rent_mon');
			// var rent_year = document.getElementById('rent_year');
			// var rendite = document.getElementById('rendite');
			// var amor = document.getElementById('amor');
			// rent_year.innerHTML = Math.round(rent_mon.value * 12);
			// rent_size.innerHTML = (rent_mon.value / size.value).toFixed(2);
			// rendite.innerHTML = ((rent_year.innerHTML * 1 / total.innerHTML * 1) * 100).toFixed(2);
			// amor.innerHTML = Math.round(total.innerHTML * 1 / rent_year.innerHTML * 1);

			// var mail = document.getElementById('mail');
			// var href = "abc%0Ahttps://max.pub/immo";
			// mail.setAttribute('href', "mailto:?subject=Haus XXX&body=" + href);

		}
		window.addEventListener('hashchange', update)
		update();
	</script>

</body>

</html>